# IoT Platform for Earthquake Evacuation Service
### Real-time alerts, optimized routes. Stay safe with our IoT-based earthquake evacuation service.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/9c9d2af7-4761-41a2-a731-bdb2aab4da16)
---
## Team : Donggongzizin
"Donggongzizin(Eye shaking)" is a medical term also called "Pupillary Light Reflex" or "Pupillary Light Reaction" in Korean. The term refers to physiological phenomena related to pupil size and response.

## Problem
Current challenges during earthquakes include confusion among people, hindering their ability to access earthquake information and respond effectively to the aftermath. The key issues contributing to this situation are a lack of awareness about earthquake risks and the absence of real-time earthquake alert systems using IoT devices.

##  Our service addresses these challenges by offering the following features
- Real-time earthquake occurrence sharing through the integration of the Mobius server.
- Instant earthquake notifications delivered to IoT devices and the app.
- Provision of evacuation guidance by setting evacuation locations and current positions to determine optimal evacuation routes.
- Provision of actionable guidelines based on the specific earthquake situation.

## Here's a scenario illustrating how our service works
### <IoT Devices S/W>
1. In the event of an earthquake, the vibration detection sensor detects and uploads the value corresponding to the group of KETIDGZ_earthquake (AE_1).
2. Update the earthquake-related data generated by scraping the Korea Meteorological Administration website to the web_scraping container of KETIDGZ_earthquake (AE_1).

### <Backend>
3. When (iOS) KETIDGZ_earthquake(AE_1)/earthquake_detection receives an earthquake signal, change the view to an earthquake occurrence view, and upload the latitude and longitude to KETIDGZ(AE_2)/mylocation.
4. Obtain information from KETIDGZ(AE_2)/mylocation and use the shortest distance algorithm from the local server to find the route to the nearest shelter and update it to the KETIDGZ(AE_2)/locationURL container.
5. When you receive an evacuation signal, change the view to an evacuation view, and when you press the evacuation center button, download the URL using the Kakao Map API from KETIDGZ (AE_2)/location URL and open the Kakao Map app.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/9eff9a91-8f35-4fe1-8c74-9b87fdb73026)

## Server Application
### Receive Location Data
The server application receives location data from the client through the Mobius platform. This data include latitude and longitude coordinates information.

### Fetch Shelter Information
Using the received location data, the server application makes use of the KakaoMap API to fetch information and stored shelter about nearby shelters. These include the coordinates, name, address, contact information, and other relevant details of the shelters in the vicinity.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/95003642-6c78-48d3-a908-48f02ffe93fd)

### Distance Calculation
The server application employs a distance calculation algorithm, such as the Haversine formula, to determine the distance between the client's location and each of the available shelters. This helps identify the nearest shelter.
### What is Haversine formula?
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/276522fc-2e89-44e6-bf05-96b707780cea)

### Select Nearest Shelter
Based on the calculated distances, the server application selects the nearest shelter as the destination for the client. This shelter is chosen as the most suitable option for the client to seek refuge.

### Generate KakaoMap URL
The server application generates a KakaoMap URL that represents the route from the client's location to the selected shelter. This URL typically includes the necessary parameters, such as the origin and destination coordinates, to display the route on KakaoMap.

### Upload URL to Mobius Platform
The generated KakaoMap URL is uploaded to the Mobius platform, making it accessible to the client. This allows the client to retrieve the URL and access the route information from the server.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/7686fe33-e3c2-413b-9be3-b98ea5d2410e)

## IoT Devices resources monitor
The following shows how IoT devices exchange resources in the event of an earthquake in a tree form.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/58244ec7-888e-4c18-a977-de4d5d0e8114)

## Using oneM2M protocol
There are four IoT devices (earthquake sensor, buzzer, Led, display) under the ae called KETIDGZ_earthquake. When an earthquake is detected, the seismic sensor transmits data to four IoT devices, including itself.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/43d57f97-a90b-47bb-8743-95325c27ad8c)
IoT devices are made up of groups and can be controlled simultaneously using the HTTP POST (fopt) method. This allows users to operate and monitor multiple devices simultaneously with a single request. This method enables efficient and integrated control and management, making it convenient for users to manage device groups.

Other sensors, except for seismic sensors, are used in everyday life as home appliances, and in case of an emergency earthquake, they may be repurposed according to their respective command values.

Normally, IoT devices can control power based on the values stored in the Data container, and the values stored in the server can provide feedback related to the user's energy and lifestyle habits.

## Sensors
Each sensor operates as follows.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/802d4b25-7cd2-4e32-bdb6-8469f4c06043)

- Earthquake_detection
Implemented using MPU-6050 6-axis gyro sensor. Based on the data measured by the sensor, angular velocity changes and values are calculated, and an algorithm is applied to detect data above a certain threshold by vibration. The ability to adjust the value according to the magnitude of the vibration is not included in the code.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/5ab088e5-2c03-493e-b290-0a1c06484da2)
- Led & Display
LEDs are used to indicate seismic warning conditions, and the display displays seismic information to communicate relevant information to the user. This allows users to receive immediate and clear visual notifications.
- Buzzer
When the vibration detection sensor is activated, the buzzer connected to the GPIO operates to generate an audible signal indicating the occurrence of vibration.

## Scrapping

[Youtube]
https://youtu.be/iF7oXesBXAY

We can utilize real-time earthquake information services provided by meteorological agencies. These websites offer information about the magnitude, location, and maximum intensity of earthquakes that occur. In this case, we are scraping data from the website using a raspberry pi and uploading it to the Mobius platform. If an earthquake occurs in a region other than the last observed earthquake occurrence area, data is uploaded to the Mobius platform.

### About Simulation
The website also provides simulated videos of past earthquake cases. For the simulation, we used data from an earthquake that occurred in Seogwipo, Jeju on December 14, 2021.

- Korea Meteorological Administration Site: https://www.weather.go.kr/pews/

## iOS Application

The iOS application is designed with the goal of reducing confusion during and after an earthquake. By providing a UI (User Interface) and UX (User Experience) that matches the scenarios before, during, and after an earthquake, we aim to provide users with relevant action guidelines, ensuring faster and more accurate information provision.

The following details the View, Layout, and information the application provides according to different situations.


### Normal State (Stable Situation)
First, consider the state of stability when an earthquake has not occurred. In this state, we primarily provide information on what measures users should take in preparation for an earthquake.

- How to prepare before an earthquake occurs
- A page summarizing information about earthquakes and guidelines that can help prepare for when an earthquake happens
- Continuous monitoring for any occurrence of an earthquake, and promptly changing the View and Layout to reflect the situation during an earthquake when one occurs


![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/d96f9e37-0529-46fc-87db-4d699b5766a7)

### While Earthquake (During an Earthquake)
[Youtube]
https://youtu.be/1MZJL5_B_wE
When an earthquake occurs, we recognize that there's a limit to the information that can be provided within the application. We, therefore, link to the Meteorological Agency's webpage, which we deem to provide the most accurate guidelines for action during an earthquake, and encourage users to open the page. This helps users access the necessary actions during an earthquake more quickly.

- When an earthquake, measure the current latitude and longitude and upload them to the Mobius platform

![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/4a6a2190-a076-4a2c-ae4e-598e88c8f5d9)

- Provide the magnitude and maximum expected intensity of the current earthquake
- Link to the Meteorological Agency's 'Action Guidelines during an Earthquake' page to provide information on how users should act during an earthquake
- Continuously monitor if the earthquake has ended, and once it ends, immediately update the View and Layout to reflect the post-earthquake state.
![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/2c73258f-8b3c-43d8-94ca-6e5850ac99d7)
### After Earthquake (After an Earthquake)

After an earthquake, we provide information about post-earthquake response and evacuation guidelines and provide the shortest route to the nearest shelter to assist users in evacuating quickly.

Provide information about the final measured magnitude and the maximum measured intensity of the occurred earthquake
Provide brief information about the action guidelines after an earthquake
Use the latitude and longitude uploaded to the Mobius platform to generate a KakaoMap API URL, and display the shortest route to the nearest shelter through the KakaoMap application.

![image](https://github.com/jeonsion/KETIDGZ_HW/assets/57317636/6ad3c144-7202-477b-a5e2-53f27b81c3b8)

### Demo video
[Youtube]
https://youtu.be/LH-3efzLHLY
### Link
[Hackster.io]
https://www.hackster.io/donggongzizin/iot-platform-for-earthquake-evacuation-service-46938f

---


## H/W
![buzzer_and_led_bb](https://github.com/jeonsion/oneM2M_Hackathon_7th_Mobius_Developer/assets/57317636/b6a335bb-b47c-42aa-886b-9f2f13379e1a)
![Display_bb](https://github.com/jeonsion/oneM2M_Hackathon_7th_Mobius_Developer/assets/57317636/b748fbc6-f243-43e1-ad22-361188522a1e)
![earthquake_detection_Sketch_bb](https://github.com/jeonsion/oneM2M_Hackathon_7th_Mobius_Developer/assets/57317636/5d1126f8-a57d-41af-b013-6c230c2b0792)


